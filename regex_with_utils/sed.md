## sed 的执行顺序
- sed 的执行顺序

```c
1/
     读取一行到 模式空间 ,可以从标准 输入读, 可以从文件读 

2/
     到模式空间执行命令 ,命令可以放到命令集,也可以放到文件中 如果命令中有 q 则,退出

3/
     打印模式空间中的内容 ,注意,模式空间中的内容已经改变,但是源文件或者 标准输入的内容没变

4/
     清空模式空间的内容

5/
     跳转到1
```


- 过程1 读取一行到模式空间
```c

1/ 从标准输入
     cat testfile | sed 'command1'
2/ 从文件
     sed  'command1' testfile
     sed  'command1' testfile1 testfile2

```


- 过程2 在模式空间 执行命令
```c
注意:
     每一行都要执行这条命令,我们可以针对每一行做一样的动作,也可以做不同的动作
     另外,命令执行的对象都是模式空间中的内容,不是文件中的内容
     模式空间应该是内存里面的内容
     另外,删除后面的命令无法操作对象,因为对象已经被删除了

命令的键入

1/ 从标准输入

     cat testfile | sed 'command1'
     cat testfile | sed -e 'command1;command2'
     cat testfile | sed -e 'command1' -e 'command2'
     
     cat testfile | sed -e 'command1'\
     -e 'command2'



     cat testfile | sed -e '{
     command1 
     command2
     }'
     
2/ 从sed脚本文件

     echo "''" > test.sed
     cat testfile | sed -f test.sed

     脚本文件中  注释用# 
     第一行为#n,则自动执行 -n


```




- 过程3 打印模式空间的内容

```c
默认打印模式空间中所有的内容
即每次循环都默认无条件打印

可以指定打印
1/
     -n 屏蔽默认输出
2/
     用命令 p 打印指定输出

如何指定输出
1/ 行数指定
     'p'       无条件打印行
     '2 p'     如果是第二行,才打印
     '1,4 p'   如果是1到4行,才打印
     '2,$ p'   如果是2到最后一行,才打印
     '1,+3 p'  打印 1 2 3 行
     '1~3 p'   打印 1 4 7 ... 行
2/ 模式匹配
     '/picqiu/,9 p'  效果是打印 9 - picqiu 或者 picqiu 到 9 行,如果匹配不到,打印 9 - $
     

```

- 过程4 清空模式空间中的内容

```c


```


---

## 基本命令

- 所有命令的格式

```c
如果写在命令行中,要用 '' 或者 "" 或者 \ 来放置 shell 解释

一般写的时候,都是这么写

'[range] command [params]'

range 部分 用来 匹配行 ,注意,匹配的是行
command 部分 是命令
params 部分 是命令的参数


[] 代表可以省略


range

注意,匹配的是行
     
以 命令 p 做例子

1/ 行数指定
     'p'        无条件执行行
     '2 p'     如果是第二行,才执行
     '1,4 p'   如果是1到4行,才执行
     '2,$ p'   如果是2到最后一行,才执行
     '1,+3 p'  执行 1 2 3 行
     '1~3 p'   执行 1 4 7 ... 行
2/ 模式匹配
     '/picqiu/,9 p'  效果是执行 9 - picqiu 或者 picqiu 到 9 行,如果匹配不到,执行 9 - $

     '/^picqiu/ p' 对 行首为 picqiu 的 行 进行打印

     range 中 可以填充 正则表达式,正则表达式填充的位置为 // 两个符号的中间 
注意: 对 range 的取反 在 //后面加! ,例如 /picqiu/! 匹配条件是 没有匹配到 picqiu

```


- 打印

```c
默认打印模式空间中所有的内容到标准输出
即每次循环都默认无条件打印

可以指定打印
1/
     -n 屏蔽默认输出
2/
     用命令 p 打印指定输出

'p'
```

- 删除

```c

'd' 无条件删除行

'/^#/ d' 以#开头,则删除


```

- 写文件

```c

-n 关闭默认输出

'w output.txt'

'/picqiu/,$ w output.txt'


```

- 替换

```c

替换也符合上面的模式,只不过复杂一点

替换的 command 部分 是 s
替换的 params 部分 是 /original-string/replacement-string/[substitute-flags]

substitute-flags 
     不加的情况下为默认情况,只替换 匹配的一行中 第一次出现的 original-string 
     g 替换 匹配的一行中 出现的 所有的 original-string
     1 只替换 匹配的一行中 第 1 次出现的 original-string
     2 只替换 匹配的一行中 第 2 次出现的 original-string

     p 替换成功后打印,没有替换不打印
     w output.txt 替换成功后保存,没有替换不保存
     e 替换成功后 将 模式空间中的 字符串 在 shell 中执行

     i 忽略大小写匹配



     另外:
     这些 substitute-flags 可以 自由组合


     gp 只替换 匹配的一行中 出现的 所有的 original-string,替换成功后并打印,没有替换不打印

original-string
     //中的 original-string 可以用 正则表达式替换

replacement-string
     可以用 &替代 匹配成功 的 original-string 

分组替换
     \(\)
         \(ab\)*:ab整体作为匹配字符，且匹配任意次
         \(ab\)\{1,\}：ab整体作为匹配字符，且匹配至少一次
         \(ab\)：ab整体作为匹配字符
     
     后向引用
         \1：匹配第一个左括号以及与之对应的右括号所包括的所有内容
         \2：匹配第二个左括号以及与之对应的右括号所包括的所有内容
         \3：匹配第三个左括号以及与之对应的右括号所包括的所有内容

     分组替换一般用于从一行中 汲取 一个或几个内容 并 替换 原来的内容

```

- 追加 

```c

'a i am a new line' 在每行的下一行无条件追加
'$ a i am a new line' 在最后一行的下一行无条件追加


```


- 前加

```c

'i'
在 行之前添加

```

- 修改

```c

'c'

修改为新行

```

- 打印不可见字符

```c

'I'

可打印 制表符 ,回车符 (用某个特殊符号显示在屏幕上)
```

- 打印行号

```c

'='

```

- 转换字符

```c

'y'

转换大小写
'y/abcde/ABCDE'


```

- 退出
```c

'5 q'

运行到第5行退出

```

- 命令中读取文件

```c

'5 r file'

读取文件并在打印该行后打印出来
用于拼接文件

```

- 命令 n
```c

遇到n ,

1/
     打印模式空间的内容
2/
     清空模式空间
3/
     读取下一行
4/
     把上次跳过的命令用于 新的一行

```


---

## sed 的选项
```c
-n 不打印
-i 直接在文件中修改
-ibak  直接在文件中修改,修改之前备份一份

```


---

## sed 脚本文件

```c
1/ 作为选项存在
     sed -f test.sed testfile
     


2/ 作为命令存在
     chmod u+x ./test.sed
     ./test.sed testfile

     #!/bin/sed -f #也可以加上n 变为 #!/bin/sed -nf ,nf 的顺序不能反
```

- 与 脚本中的循环和分支 相关的 命令

```c

循环1

:lable

range b lable

循环2

:lable3

range t lable3


分支

range b lable2

:lable2
```

---

## sed 的缓冲区

```c

模式空间
     会在每次循环中清0
保持空间
     不会再循环中清0

```

- 跟缓冲区相关的命令


- 缓冲区交换

```c

'x'

命令x 用于交换 模式空间和 保持空间 的内容

```

- 模式空间->保持空间

```c

'h'

将 模式空间的内容复制到保持空间,覆盖

'H'

将 模式空间的内容复制到保持空间,追加

```

- 保持空间->模式空间

```c
'g'

将保持空间的内容复制到模式空间,覆盖

'G'

将保持空间的内容复制到模式空间,追加

```

---

## sed 的多行模式

```c

默认情况下, sed 是单行模式,也就是一次处理一行

但是,如果有命令将 模式空间里面 添加了几行,那么 sed 就会处理 多个行

```

- 多行模式相关的命令

- 从文件中读取并追加
```c

'N'

遇到 N,

1/
     在当前模式空间中加入换行符
2/
     从输入流中读取下一行内容,追加到当前模式空间
3/
     继续执行后面的命令

```

- 打印一行

```c

'P'

```


- 删除一行

```c

'D'

```


